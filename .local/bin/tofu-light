#!/bin/sh
action=$1

set -eu

step=5

focused_output="$(swaymsg -t get_tree | jq -r '.nodes[] | select([recurse(.nodes[]?, .floating_nodes[]?) | .focused] | any) | .name')"

case "$focused_output" in
    eDP-1)
        case "$action" in
            inc)
                brightnessctl s +$step%
                ;;
            dec)
                brightnessctl s $step%-
                ;;
            *)
                echo "Invalid action, expecting one of inc, dec"
                exit 2
                ;;
        esac
        value=$(echo "$(brightnessctl g) / $(brightnessctl m) * 100" | bc -l | xargs printf '%.*f\n' 0)
        ;;
    *)
        case "$action" in
            inc)
                value=$(ddccontrol -r 0x10 -W +$step dev:/dev/i2c-6 | grep "Control 0x10" | cut -d'/' -f2)
                ;;
            dec)
                value=$(ddccontrol -r 0x10 -W -$step dev:/dev/i2c-6 | grep "Control 0x10" | cut -d'/' -f2)
                ;;
            *)
                echo "Invalid action, expecting one of inc, dec"
                exit 2
                ;;
        esac
        ;;
esac


    
wob="$(systemctl show --user wob.socket -p Listen | sed 's/Listen=//' | cut -d' ' -f1)"
if [ "$wob" != '' ]; then
    echo "$value" > "$wob"
fi

